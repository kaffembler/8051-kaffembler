; Serial
RST EQU P3.0
CLK EQU P3.1
DQ  EQU P3.2
; Temp Trigger
;TC  EQU P0.0
;TL  EQU P0.1
;TH  EQU P0.2


SETB CLK

; Reset Thermometer
CLR RST
NOP
SETB RST

; Request Temperature (AAh = 10101010b)
CALL SEND_0
CALL SEND_1
CALL SEND_0
CALL SEND_1
CALL SEND_0
CALL SEND_1
CALL SEND_0
CALL SEND_1

; ==================
SETB DQ
CALL CLOCK
CALL CLOCK
CALL CLOCK
CALL CLOCK
CALL CLOCK
CALL CLOCK
CALL CLOCK
CALL CLOCK
CALL CLOCK
CALL SHOW

LOOP:
  JMP LOOP

SEND_1:
  CLR CLK
  SETB DQ
  SETB CLK
  RET

SEND_0:
  CLR CLK
  CLR DQ
  SETB CLK
  RET

CLOCK:
  CLR CLK
  JB DQ, SET_CARRY
  CALL SHIFT_AND_CLOCK_HIGH
  RET

SET_CARRY:
  SETB C
  CALL SHIFT_AND_CLOCK_HIGH
  RET

SHIFT_AND_CLOCK_HIGH:
  SETB CLK
  RRC A
  RET

SHOW:
  MOV B, #0Ah
  DIV AB
  ; Wert von B auf rechte 7-Segment Anzeige  
  CALL SHOW_NUMBER
  MOV P0, #11111110b
  MOV B, #0Ah
  DIV AB
  ; Wert von B auf mittlere 7-Segment Anzeige
  CALL SHOW_NUMBER
  MOV P0, #11111101b
  MOV B, A
  ; Wert von B auf linke 7-Segment Anzeige
  CALL SHOW_NUMBER
  MOV P0, #11111011b
  RET

SHOW_NUMBER:
  ; B aufl√∂sen auf Port 1
  RET